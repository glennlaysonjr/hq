<script setup lang="ts">
import { useToggle } from "@vueuse/core";
import axios from "axios";

const weatherActive = ref(false);
const toggleWeather = useToggle(weatherActive);

const { data: weather, isFetching } = useQuery({
  queryKey: ["weather"],
  queryFn: async () => {
    const { data } = await axios.get(
      "https://weatherapi-com.p.rapidapi.com/current.json",
      {
        params: {
          q: "dallas, tx",
        },
        headers: {
          "X-RapidAPI-Key":
            "4bd053ba9fmshccbbc6e2a8259aap1b768djsnc8e5e1900ea4",
          "X-RapidAPI-Host": "weatherapi-com.p.rapidapi.com",
        },
      },
    );
    return data;
  },
  onSuccess: (data) => {},
  onError: (error) => {},
});

const currentWeather = computed(() => {
  const current = weather.value?.current?.condition?.text?.toLowerCase();
  if (current?.includes("cloudy") && weather.value.current.is_day)
    return "cloudy";
  if (current?.includes("sun") && weather.value.current.is_day) return "sunny";
  if (current?.includes("rain")) return "rain";
  if (current?.includes("thunder")) return "thunderstorm";
  if (current?.includes("snow")) return "snow";
  return "night";
});

const weatherMessage = computed(() => {
  const temp = weather.value?.current?.temp_f;
  const current = weather.value?.current?.condition?.text;
  return `It's ${temp}Â°F and ${current} in Dallas, TX`;
});

watch(
  () => weatherActive.value,
  () => {
    console.log(weatherActive.value);
  },
);
</script>

<template>
  <ClientOnly>
    <div class="weather" v-if="!isFetching">
      <CommonHoverCard>
        <div v-if="currentWeather === 'cloudy' && !isFetching">
          <svg
            width="70"
            height="60"
            viewBox="0 0 70 60"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M58.4 22.5306C58 20.6306 57.2 18.8306 56 17.1306C54.9 15.5306 53.4 14.1306 51.8 13.0306C50.1 11.9306 48.2 11.1306 46.1 10.8306C44.1 10.4306 42 10.5306 40 11.0306C38.1 11.4306 36.3 12.2306 34.6 13.4306C32.9 14.6306 31.6 16.0306 30.5 17.6306C30.1 18.2306 29.8 18.7306 29.5 19.3306C27.1 18.2306 24.5 17.6306 21.8 17.6306C11.7 17.6306 3.4 25.8306 3.4 36.0306C3.4 36.6306 3.4 37.2306 3.5 37.8306C1.3 40.2306 0 43.3306 0 46.5306C0 53.6306 5.8 59.4306 12.9 59.4306H37.8C46.5 59.4306 53.6 52.3306 53.6 43.6306C53.6 41.6306 53.2 39.7306 52.6 38.0306C54 36.9306 55.2 35.6306 56.2 34.2306C57.3 32.5306 58.1 30.6306 58.4 28.5306C58.9 26.5306 58.8 24.5306 58.4 22.5306ZM38 54.8306H13.1C8.5 54.8306 4.8 51.1306 4.8 46.5306C4.8 45.1306 5.2 43.7306 5.9 42.4306C7.4 44.1306 9.6 45.2306 12.1 45.3306C9.7 42.8306 8.3 39.5306 8.3 35.8306C8.3 33.1306 9.1 30.6306 10.4 28.5306C12.8 24.7306 17.1 22.2306 22 22.2306C24.2 22.2306 26.4 22.8306 28.4 23.8306C30.7 25.0306 32.6 26.8306 33.9 29.0306C32.2 29.9306 30.9 31.4306 30.1 33.1306C29.5 34.3306 29.2 35.6306 29.1 37.0306C29.7 36.2306 30.4 35.5306 31.2 34.9306C33.1 33.4306 35.5 32.5306 38.1 32.5306C42.4 32.5306 46.2 34.9306 48.1 38.5306C48.4 39.1306 48.6 39.6306 48.8 40.2306C49.1 41.3306 49.3 42.4306 49.3 43.6306C49.2 49.8306 44.2 54.8306 38 54.8306Z"
              fill="inherit"
            />
            <path
              d="M46.7 7.53063C48.2 7.83063 49.3 3.73063 49.5 2.53063C49.7 1.33063 49 0.230629 48 0.0306287C47 -0.169371 46 0.63063 45.8 1.83063C45.6 3.03063 45.2 7.23063 46.7 7.53063Z"
              fill="inherit"
            />
            <path
              d="M37.1 8.33066C38.6 7.83066 37.4 3.73066 37 2.63066C36.6 1.53066 35.5 0.830656 34.5 1.23066C33.5 1.63066 33.1 2.83066 33.5 3.93066C33.9 5.03066 35.6 8.83066 37.1 8.33066Z"
              fill="inherit"
            />
            <path
              d="M23.8001 11.8306C24.7001 12.6306 28.2001 15.0306 29.2001 13.8306C30.2001 12.6306 27.2001 9.73063 26.3001 8.93063C25.4001 8.13063 24.1001 8.13063 23.4001 8.93063C22.7001 9.83063 22.9001 11.1306 23.8001 11.8306Z"
              fill="inherit"
            />
            <path
              d="M63.1 39.9306C62.2 39.1306 58.7 36.7306 57.7 37.9306C56.7 39.1306 59.7 42.0306 60.6 42.8306C61.5 43.6306 62.7999 43.6306 63.4999 42.8306C64.2999 42.0306 64 40.7306 63.1 39.9306Z"
              fill="inherit"
            />
            <path
              d="M67.5 28.2306C66.3 28.0306 62.1 27.6306 61.9 29.1306C61.6 30.6306 65.7 31.7306 66.9 31.9306C68.1 32.1306 69.2001 31.4306 69.4001 30.4306C69.5001 29.4306 68.7 28.4306 67.5 28.2306Z"
              fill="inherit"
            />
            <path
              d="M66.7 19.4306C67.8 19.0306 68.5 17.9306 68.1 16.9306C67.7 15.9306 66.5 15.5306 65.4 15.9306C64.3 16.3306 60.4 18.1306 61 19.5306C61.6 20.9306 65.6 19.8306 66.7 19.4306Z"
              fill="inherit"
            />
            <path
              d="M55.4999 11.6306C56.6999 12.6306 59.5999 9.63061 60.3999 8.73061C61.1999 7.83061 61.1999 6.53061 60.3999 5.83061C59.5999 5.13061 58.2999 5.33061 57.4999 6.33061C56.6999 7.13061 54.2999 10.6306 55.4999 11.6306Z"
              fill="inherit"
            />
          </svg>
        </div>
        <div v-if="currentWeather === 'snow' && !isFetching">
          <svg
            width="63"
            height="75"
            viewBox="0 0 63 75"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M48.1 12.4C47.1 12.1 46.1 12 45.1 12C45 12 45 12 44.9 12C43.3 8.8 40.9 6 37.9 3.9C34.3 1.4 30 0 25.6 0C13.7 0 4 9.7 4 21.6C4 22.3 4 23 4.1 23.7C1.4 26.6 0 30.2 0 34.1C0 42.5 6.8 49.2 15.1 49.2H44.4C54.7 49.2 63 40.9 63 30.6C63 21.6 56.6 14.1 48.1 12.4ZM44.4 43.8H15.1C9.7 43.8 5.4 39.4 5.4 34.1C5.4 32.4 5.8 30.8 6.7 29.3C8.5 31.3 11.1 32.6 14 32.7C11.2 29.8 9.5 25.8 9.5 21.5C9.5 18.3 10.4 15.4 12 12.9C14.9 8.4 19.9 5.4 25.7 5.4C31.4 5.4 36.8 8.5 39.7 13.4C36.4 15.3 34.2 18.7 34 22.8C36.4 19.6 40.3 17.5 44.6 17.5C49.7 17.5 54.1 20.4 56.3 24.6C57.2 26.4 57.8 28.5 57.8 30.6C57.6 37.9 51.7 43.8 44.4 43.8Z"
              fill="inherit"
            />
            <path
              d="M35.6 54.6L36.9 57.1L39.4 58.5L36.9 59.8L35.6 62.3L34.2 59.8L31.7 58.5L34.2 57.1L35.6 54.6Z"
              fill="inherit"
            />
            <path
              d="M23.2 54.6L24.8 57.6L27.7 59.2L24.8 60.8L23.2 63.7L21.6 60.8L18.7 59.2L21.6 57.6L23.2 54.6Z"
              fill="inherit"
            />
            <path
              d="M30 68.3L31.1 70.2L33.1 71.3L31.1 72.4L30 74.4L28.9 72.4L27 71.3L28.9 70.2L30 68.3Z"
              fill="inherit"
            />
          </svg>
        </div>
        <div v-if="currentWeather === 'rain' && !isFetching">
          <svg
            width="63"
            height="77"
            viewBox="0 0 63 77"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M48.1 12.4C47.1 12.1 46.1 12 45.1 12C45 12 45 12 44.9 12C43.3 8.8 40.9 6 37.9 3.9C34.3 1.4 30 0 25.6 0C13.7 0 4 9.7 4 21.6C4 22.3 4 23 4.1 23.7C1.5 26.5 0 30.2 0 34C0 42.4 6.8 49.1 15.1 49.1H44.4C54.7 49.1 63 40.8 63 30.5C63 21.7 56.6 14.1 48.1 12.4ZM44.4 43.9H15.1C9.7 43.9 5.4 39.5 5.4 34.2C5.4 32.5 5.8 30.9 6.7 29.4C8.5 31.4 11.1 32.7 14 32.8C11.2 29.9 9.5 25.9 9.5 21.6C9.5 18.4 10.4 15.5 12 13C14.9 8.5 19.9 5.5 25.7 5.5C31.4 5.5 36.8 8.6 39.7 13.5C36.4 15.4 34.2 18.8 34 22.9C36.4 19.7 40.3 17.6 44.6 17.6C49.7 17.6 54.1 20.5 56.3 24.7C57.2 26.5 57.8 28.6 57.8 30.7C57.6 37.9 51.7 43.9 44.4 43.9Z"
              fill="inherit"
            />
            <path
              d="M27 63.1C26.5 65.4 24.2 66.8 21.9 66.3C19.6 65.8 18.2 63.5 18.7 61.2C19.4 57.9 24.9 53.1 24.9 53.1C24.9 53.1 27.8 59.6 27 63.1Z"
              fill="inherit"
            />
            <path
              d="M38.6 62.4C38.2 64.2 36.4 65.4 34.6 64.9C32.8 64.5 31.6 62.7 32.1 60.9C32.7 58.3 37 54.5 37 54.5C37 54.5 39.2 59.6 38.6 62.4Z"
              fill="inherit"
            />
            <path
              d="M31.6 74.8C31.3 76.3 29.8 77.2 28.3 76.9C26.8 76.6 25.9 75.1 26.2 73.6C26.7 71.4 30.3 68.3 30.3 68.3C30.3 68.3 32.1 72.4 31.6 74.8Z"
              fill="inherit"
            />
          </svg>
        </div>
        <div v-if="currentWeather === 'sunny' && !isFetching">
          <svg
            width="62"
            height="62"
            viewBox="0 0 62 62"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M30.9 48.9C28.5 48.9 26.1 48.4 23.9 47.5C21.8 46.6 19.8 45.3 18.2 43.6C16.5 41.9 15.3 40 14.3 37.9C13.4 35.7 12.9 33.3 12.9 30.9C12.9 28.5 13.4 26.1 14.3 23.9C15.2 21.8 16.5 19.8 18.2 18.2C19.9 16.6 21.8 15.3 23.9 14.3C26.1 13.4 28.5 12.9 30.9 12.9C33.3 12.9 35.7 13.4 37.9 14.3C40 15.2 42 16.5 43.6 18.2C45.2 19.9 46.5 21.8 47.5 23.9C48.4 26.1 48.9 28.5 48.9 30.9C48.9 33.3 48.4 35.7 47.5 37.9C46.6 40 45.3 42 43.6 43.6C41.9 45.3 40 46.5 37.9 47.5C35.7 48.4 33.3 48.9 30.9 48.9Z"
              fill="inherit"
            />
            <path
              d="M30.9 0C29.7 0 28.7 1.1 28.7 2.6C28.7 4 29.1 9 30.9 9C32.7 9 33.1 4.1 33.1 2.6C33.1 1.1 32.1 0 30.9 0Z"
              fill="inherit"
            />
            <path
              d="M30.9 61.8C29.7 61.8 28.7 60.7 28.7 59.2C28.7 57.8 29.1 52.8 30.9 52.8C32.7 52.8 33.1 57.7 33.1 59.2C33.1 60.7 32.1 61.8 30.9 61.8Z"
              fill="inherit"
            />
            <path
              d="M15.4 4.1C14.3 4.7 14 6.2 14.8 7.4C15.5 8.6 18.3 12.7 19.9 11.8C21.5 10.9 19.4 6.4 18.7 5.2C18 4 16.5 3.5 15.4 4.1Z"
              fill="inherit"
            />
            <path
              d="M46.4 57.7C45.3 58.3 43.9 57.8 43.2 56.6C42.5 55.4 40.4 50.9 42 50C43.6 49.1 46.4 53.2 47.1 54.4C47.7 55.6 47.4 57.1 46.4 57.7Z"
              fill="inherit"
            />
            <path
              d="M4.1 15.4C3.5 16.5 4.00001 17.9 5.20001 18.6C6.40001 19.3 10.9 21.5 11.8 19.9C12.7 18.3 8.60001 15.5 7.40001 14.8C6.20001 14.1 4.7 14.4 4.1 15.4Z"
              fill="inherit"
            />
            <path
              d="M57.7 46.4C57.1 47.5 55.6 47.8 54.4 47C53.2 46.3 49.1 43.5 50 41.9C50.9 40.3 55.4 42.4 56.6 43.1C57.8 43.9 58.3 45.3 57.7 46.4Z"
              fill="inherit"
            />
            <path
              d="M0 30.9C0 32.1 1.1 33.1 2.6 33.1C4.1 33.1 8.9 32.7 8.9 30.9C8.9 29.1 4 28.7 2.5 28.7C1 28.7 0 29.7 0 30.9Z"
              fill="inherit"
            />
            <path
              d="M61.8 30.9C61.8 32.1 60.7 33.1 59.2 33.1C57.7 33.1 52.9 32.7 52.9 30.9C52.9 29.1 57.8 28.7 59.3 28.7C60.8 28.7 61.8 29.7 61.8 30.9Z"
              fill="inherit"
            />
            <path
              d="M4.1 46.4C4.7 47.5 6.20001 47.8 7.40001 47C8.60001 46.3 12.7 43.5 11.8 41.9C10.9 40.3 6.40001 42.4 5.20001 43.1C4.00001 43.9 3.5 45.3 4.1 46.4Z"
              fill="inherit"
            />
            <path
              d="M57.7 15.4C58.3 16.5 57.8 17.9 56.6 18.6C55.4 19.3 50.9 21.5 50 19.9C49.1 18.3 53.2 15.5 54.4 14.8C55.6 14.1 57.1 14.4 57.7 15.4Z"
              fill="inherit"
            />
            <path
              d="M15.4 57.7C16.5 58.3 17.9 57.8 18.6 56.6C19.3 55.4 21.4 50.9 19.8 50C18.2 49.1 15.4 53.2 14.7 54.4C14.1 55.6 14.4 57.1 15.4 57.7Z"
              fill="inherit"
            />
            <path
              d="M46.4 4.1C47.5 4.7 47.8 6.2 47 7.4C46.3 8.6 43.5 12.7 41.9 11.8C40.3 10.9 42.4 6.4 43.1 5.2C43.8 4 45.3 3.5 46.4 4.1Z"
              fill="inherit"
            />
          </svg>
        </div>
        <div v-if="currentWeather === 'thunderstorm' && !isFetching">
          <svg
            width="63"
            height="75"
            viewBox="0 0 63 75"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M48.1 12.4C47.1 12.1 46.1 12 45.1 12C45 12 45 12 44.9 12C43.3 8.8 40.9 6 37.9 3.9C34.3 1.4 30 0 25.6 0C13.7 0 4 9.7 4 21.6C4 22.3 4 23 4.1 23.7C1.4 26.5 0 30.2 0 34.1C0 42.5 6.8 49.2 15.1 49.2H25.1L22.9 58.6L28.3 59.4L23.5 75L37.7 53.7L31.3 52.8L33.4 49.1H44.4C54.7 49.1 63 40.8 63 30.5C63 21.6 56.6 14.1 48.1 12.4ZM44.4 43.8H15.1C9.7 43.8 5.4 39.4 5.4 34.1C5.4 32.4 5.8 30.8 6.7 29.3C8.5 31.3 11.1 32.6 14 32.7C11.2 29.8 9.5 25.8 9.5 21.5C9.5 18.3 10.4 15.4 12 12.9C14.9 8.4 19.9 5.4 25.7 5.4C31.4 5.4 36.8 8.5 39.7 13.4C36.4 15.3 34.2 18.7 34 22.8C36.4 19.6 40.3 17.5 44.6 17.5C49.7 17.5 54.1 20.4 56.3 24.6C57.2 26.4 57.8 28.5 57.8 30.6C57.6 37.9 51.7 43.8 44.4 43.8Z"
              fill="inherit"
            />
          </svg>
        </div>
        <div v-if="currentWeather === 'night' && !isFetching">
          <svg
            width="81"
            height="65"
            viewBox="0 0 81 65"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M78.5784 37.1657C74.8784 37.0657 71.0784 36.2657 67.3784 34.2657C59.8784 30.2657 54.8784 22.4657 54.4784 13.9657C54.2784 9.76571 55.0784 5.96571 56.5784 2.56571C57.1784 1.16571 55.9784 -0.334291 54.4784 0.0657092C45.1784 2.96571 37.8784 11.1657 37.0784 21.8657C36.8784 24.1657 41.6 26.9 42 29C48.9 30.7 51.5784 29 54.4784 35.5C59.2784 36.2 58.8 46.6 62 50C67.6 49.1 76.1784 44.3657 79.9784 40.1657C80.9784 38.9657 80.0784 37.1657 78.5784 37.1657Z"
              fill="inherit"
            />
            <path
              d="M48.1 27.4C47.1 27.1 46.1 27 45.1 27C45 27 45 27 44.9 27C43.3 23.8 40.9 21 37.9 18.9C34.3 16.4 30 15 25.6 15C13.7 15 4 24.7 4 36.6C4 37.3 4 38 4.1 38.7C1.4 41.6 0 45.2 0 49.1C0 57.5 6.8 64.2 15.1 64.2H44.4C54.7 64.2 63 55.9 63 45.6C63 36.6 56.6 29.1 48.1 27.4ZM44.4 58.8H15.1C9.7 58.8 5.4 54.4 5.4 49.1C5.4 47.4 5.8 45.8 6.7 44.3C8.5 46.3 11.1 47.6 14 47.7C11.2 44.8 9.5 40.8 9.5 36.5C9.5 33.3 10.4 30.4 12 27.9C14.9 23.4 19.9 20.4 25.7 20.4C31.4 20.4 36.8 23.5 39.7 28.4C36.4 30.3 34.2 33.7 34 37.8C36.4 34.6 40.3 32.5 44.6 32.5C49.7 32.5 54.1 35.4 56.3 39.6C57.2 41.4 57.8 43.5 57.8 45.6C57.6 52.9 51.7 58.8 44.4 58.8Z"
              fill="inherit"
            />
          </svg>
        </div>
        <template name="card-content">
          <div class="p-4 text-xs text-black">{{ weatherMessage }}</div>
        </template>
      </CommonHoverCard>
    </div>
  </ClientOnly>
</template>
<style scoped>
.weather div svg {
  @apply fill-[#5822F6]/30 hover:fill-[#5822F6] cursor-fancy w-6 h-6 transition-all duration-500 ease-in-out;
}
</style>
